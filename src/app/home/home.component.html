<div class="flex flex-col items-center">
  @if (accountService.currentUser()) {
    <form class="flex flex-col w-full items-center gap-4 m-8" (submit)="createPost()">
      <textarea 
        name="new-post" 
        id="new-post" 
        placeholder="What's on your mind?"
        [(ngModel)]="newPostText"
        class="textarea rounded-md"
        [disabled]="isSubmitting"
      ></textarea>
      <input 
        id="fileInput"
        hidden
        type="file" 
        (change)="onFileSelected($event)" 
        multiple 
        accept="image/*" 
        class="btn"
      />
      <button (click)="triggerFileInput()" type="button" class="btn btn-accent" [disabled]="isSubmitting">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
        </svg>
      </button>
  
      @if (!isSubmitting) {
        <div class="flex flex-wrap gap-2 mt-4">
          <div *ngFor="let fileData of selectedFiles; let i = index" class="indicator">
            <button 
              class="indicator-item indicator-middle indicator-center badge badge-error cursor-pointer" 
              (click)="removeImage(i)" 
              [disabled]="isSubmitting"
              type="button"
            >X</button>
            <div class="bg-base-300 grid place-items-center">
              <img [src]="fileData.previewUrl" class="w-10 h-10 object-cover rounded-md shadow-md">
            </div>
          </div>
        </div>
      }
      
      @if (newPostError) { <p class="mt-4 text-error text-sm">{{newPostError}}</p> }
  
      <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
        Submit
        @if (isSubmitting) {<span class="loading loading-spinner loading-sm"></span>}
      </button>
    </form>
  }

  <div class="grid md:w-2/3">
    @for (post of latestPosts; track post.id) {
      <app-post *ngIf="post" [post]="post" />
    }
  </div>

  <div>
    <button (click)="loadNextPage()" class="btn btn-secondary m-4">More...</button>
  </div>
</div>
